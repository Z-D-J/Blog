---
title: C语言-输入输出
date: 2021-03-01 16:55:28
tags:
---

# 流

* **流(Stream)**: C语言中，流表示==任意输入的源或任意输出的目的地==。
* 流经常表示存储在不同介质的==文件==，也经常和==不存储文件的设备(如网络端口，打印机)==关联。
* `<stido.h>`中的函数可以处理各种形式的流。

## 文件指针

* **文件指针(file pointer)**：C程序中==对流的访问是通过文件指针来实现的==。
* **文件指针的类型**：`FILE *`
  * FILE类型是在`<stdio.h>`中声明的。
  * 示例:`FILE *fp1;`

## 标准流和重定向

* `<stdio.h>`提供了3个标准流：
  1. `stdin`:标准输入流，默认是键盘。
  2. `stdout`:标准输出流，默认是屏幕。
  3. `stderr`:标准错误，默认是屏幕。
* **标准流的特性**：
  * 这三个标准流==可以直接使用，不需要对其进行声明，也不用打开或者关闭==。
  * stdin,stdout,stderr是三个==文件指针==。
* **重定向**：
  * 操作系统通过==重定向的操作改变标准流的默认含义==。
  * **输出重定向**：使stdin流表示文件，而不是键盘,通过在命令行中使用`<`实现，如：`demo <in.dat`,运行demo程序时从in.dat文件中获取数据。
  * **输出重定向**：使stdout流表示文件，而不是屏幕，通过在命令行中使用`>`实现，如：`demo >out.dat`，运行demo程序时输出到out.dat文件中。

## 文本文件和二进制文件

* `<stdio.h>`支持**文本文件**和**二进制文件**。
* **文本文件(text file)**：
  * 在文本文件中，==字节表示字符==；
  * **文本文件分为若干行**：
    * 文本文件的每一行通常==以一两个特殊字符结尾==；
    * windows系统是以==回车符`\x0d`和回行符`\x0a`==结尾；
    * unix操作系统是以==一个单独的回行符`\x0a`==结尾。
  * **文本文件末尾可以包含一个特殊的文件末尾标识符**：
    * 文件末尾标识==不是必须的，但一旦存在，就标志着文件的结束==。
* **二进制文件**：
  * 在二进制文件中，==字节可以表示很多类型的数据==。
  * 二进制文件==不分行，没有行末标记和文件末尾标记==。

# 文件操作

* `<stdio.h>`提供了一系列的文件操作，包括打开文件，关闭文件，改变文件的缓冲方式，删除文件以及重命名文件等。

## 打开文件

* **`fopen()`函数**：
  * 将文件打开并用作==流==；
  * 原型：`FILE *fopen(const char *filename, const char *mode)`
  * **filename**：要打开文件的文件名（可能包含文件的==路径信息==。）
    * 路径：在windows系统中的路径中含有`\`,会被C语言识别为转移字符，而导致错误。常用`\\`或者`/`来替换路径中的`\`。
  * **mode**:==模式字符串==，用来指定打算对文件执行的操作。对==文本文件和对二进制文件的模式字符串是不一样的==。
    * 对**文本文件**的六种模式字符串：
      1. `"r"`:打开文件用于读；
      2. `"w"`:打开文件用于写(文件不需要存在)
      3. `"a"`:打开文件用于追加（文件不需要存在）
      4. `"r+"`":打开文件用于==读和写，从文件头开始==；
      5. `"w+"`:打开文件用于==读和写（如果文件存在就清空）==；
      6. `"a+"`:打开文件用于==读和写（如果文件存在就追加）==。
    * 对**二进制文件**也有六种模式字符串，只需要在文件文件的基础上==加上b==即可。
  * **返回值**：
    * fopen函数的返回值是一个==文件指针==；
    * 当无法代开文件时，会==返回一个空指针==。

## 关闭文件

* **`flclose()`函数**:
  * 关闭不再使用的文件。
  * 原型：`int fclose(FILE *stream)`
  * **参数**：
    * ==必须是来自fopen函数或者freopen函数的文件指针==；
  * **返回值**：
    * 如果成功关闭的文件，返回==0==；
    * 如果失败，返回==EOF==(EOP是`<stdio.h>`中定义的宏)

## 为打开的流附加文件

* **`freopen()`函数**：
  * 该函数为已经打开的流附加上一个不同的文件。
  * 原型:`FILE *freopen(const char *filename, const char *mode, FILE *stream)`
  * **参数**:
    * 前两个参数同fopen一样；
    * 第三个参数是一个文件指针，指向一个已经打开了的流。
  * **返回值**：
    * 正常的返回值是它的第三个参数，一个文件指针；
    * 如果无法打开新文件，返回==空指针==。

## 从命令行获取文件名

